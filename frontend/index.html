<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>RepeatAfterMe.ai</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- navigation bar -->
    {% include "nav.html" %}

    <div class="page-title">
        <h1>Practice</h1>
    </div>

    <!-- Difficulty dropdown-->
    <form id="difficulty-form">
        <label for="difficulty">Choose a difficulty:</label>
        <select id="difficulty" class="primary">
            <option value="easy" {% if difficulty == "easy" %}selected{% endif %}>Easy</option>
            <option value="medium" {% if difficulty == "medium" %}selected{% endif %}>Medium</option>
            <option value="hard" {% if difficulty == "hard" %}selected{% endif %}>Hard</option>
        </select>
    </form>

    <br>
    
    <div class="word-wrapper">
    <span id="word">{{ word }}</span>
        {% if username %}
            <i class="fa{{ 's' if is_saved else 'r' }} fa-star save-star" 
                id="saveStar" 
                title="Save this word">
            </i>
        {% endif %}
    </div>

    <br><br>
    <button id="change-word-btn" class="primary" onclick="refreshWord()">Change Word</button>

    <h3>Record Audio:</h3>
    <button id="record-btn" class="primary">Start Recording</button>
    <p id="record-status"></p>

    <div class="centered-audio">
        <audio id="audioPlayer" controls style="display:none;"></audio>
    </div>

    <!-- audio upload form  -->
    <form id="upload-form" action="/upload" method="POST" enctype="multipart/form-data">
        <input type="hidden" id="hidden-word" name="word" value="{{ word }}">
        <input type="hidden" id="hidden-difficulty" name="difficulty" value="{{ difficulty }}"> 

        <input type="file" name="file" id="fileinput" required accept="audio/*" class="primary" style="display: none;">
        <button type="submit" class="audio-submit">Submit</button>
    </form>

    <div class="custom-separator"></div>

    <div class="results-container">
        <h3>Results:</h3>
        {% if result %}
            <div class="results-score">
                <p id="score-text" class="big-score">{{ result.score }}</p>
                <p id="feedback-text">{{ result.feedback }}</p>
            </div>

            {% if audio_data_url %}
                <h4>Your Audio:</h4>
                <audio controls src="{{ audio_data_url }}"></audio>
            {% endif %}
            {% if tts_audio_data_url %}
                <h4>Correct Audio:</h4>
                <audio controls src="{{ tts_audio_data_url }}"></audio>
            {% endif %}

            <p><strong>Transcription:</strong> {{ result.transcription }}</p>
    
        {% else %}
            <p>No results yet. Please submit an audio recording.</p>
        {% endif %}
    </div>

    {% if result and result.ai_feedback %}
        <div class="ai-feedback-section">
            <button id="toggleFeedback" class="btn-feedback">Show AI Feedback</button>
            <div id="feedbackBox" class="ai-feedback-box" style="display: none;">
                <h3>AI Feedback</h3>
                <p>{{ result.ai_feedback }}</p>
            </div>
        </div>
    {% endif %}


    <!-- Scripts -->
    <script src="/static/recorder.js"></script>
    <script src="/static/difficulty.js"></script>
    <script src="/static/saved-words.js"></script>
    <script src="/static/score-color.js"></script>
    <script src="/static/ai-feedback.js"></script>

</body>
</html>

